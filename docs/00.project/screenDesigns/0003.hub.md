# 画面仕様詳細: インタラクティブ・ハブ

[<< 画面設計書（全体）に戻る](../02.screenDesign.md)

## 1. 画面概要

- **画面ID**: `SCR-001`
- **画面名**: インタラクティブ・ハブ
- **概要**: 本アプリケーションの中核をなす、インタラクティブな学習・分析画面。ユーザーは理論の「地図」を操作し、様々な情報「レイヤー」を重ねることで、音楽理論の構造を直感的に探求する。

## 2. 画面レイアウト

### 2.1 PC

ワイドスクリーンでの利用を前提とした2カラムレイアウトを採用。画面左側に、描画内容を制御し、選択要素の情報を表示するサイドパネルを配置。画面右側には、ユーザーの主たる操作対象となるメイン表示エリアを大きく確保する。

#### 画面構成イメージ

```
+--------------------------------------------------------------------------------------------------+
| A. グローバルヘッダーナビゲーション                                                              |
+--------------------------------------------------------------------------------------------------+
|                                          |                                                       |
|   C. サイドパネル                        |   B. メイン表示エリア (Canvas)                           |
|   (Control & Information)                |                                                       |
|                                          |   +---------------------------------------------+     |
| +--------------------------------------+   |   |                                             |   |
| | C-1: 選択情報パネル                  |   |   |        [現在のキー: C Major]                    |   |
| |                                      |   |   |    B-1: 五度圏 / B-2: クロマチックサークル       |   |
| |                                      |   |   |             (Hub Component)                     |   |
| |  +---------------------------------+ |   |   |                                             |   |
| |  | C-1-1: レイヤー概念エリア       | |   |   +-----------------------------------------+         |
| |  +---------------------------------+ |   |                                                  |   |
| |  +---------------------------------+ |   |                                                 |   |
| |  | C-1-2: 選択要素エリア         | |   |                                                  |   |
| |  +---------------------------------+ |   |   +-----------------------------------------+          |
| +--------------------------------------+   |                                                    |   |
| | C-2: レイヤー・コントローラー        |   |                                                 |   |
| |  (アコーディオンUI)                  |   |                                                 |   |
| |                                      |   |                                                    |   |
| |  ▼ スケールレイヤー                  |   |   +---------------------------------------------+      |
| |    - スケールの選択 (DropDown)     |   |                                                     |
| |    - モードの表示 (Toggle)         |   |                                                       |
| |                                      |   |                                                         |
| |  ▼ コードレイヤー                     |   |                                                         |
| |    - ダイアトニックコード (Toggle) |   |                                                     |
| |    - コード構成音の図形 (Toggle)   |   |                                                    |
| |                                      |   |                                                     |
| |  ▼ 関係性レイヤー                   |   |                                                     |
| |    - 近親調 (Toggle)             |   |                                                        |
| |    - ドミナントモーション (Toggle) |   |                                                     |
| +--------------------------------------+   |                                                     |
| | C-3: ビュー・コントローラー          |   |                                                    |
| |  [ 五度圏 ] [ クロマチック ]       |   |                                                     |
| +--------------------------------------+   |                                                       |
|                                          |                                                       |
+--------------------------------------------------------------------------------------------------+

```

### 2.2. モバイル

モバイルデバイスでは、PC版とは異なり画面スペースが限られる。そのため、ユーザーが現在行いたいタスクに集中できるよう、コンテキストに応じて情報を表示するレイアウトを採用する。

具体的には、PC版の常時表示パネル（C-1, C-2, C-3）を、ユーザーのアクションを起点として表示される **ボトムシート** に格納する。これにより、メイン表示エリア（Canvas）の表示領域を最大化し、アプリケーションの核であるビジュアルへの没入感を高める。
詳細は [4. モバイルでのレスポンシブ対応]に記載。

#### 画面構成イメージ

```

---- 初期状態のイメージ ----

+------------------------------------------+
| A. ヘッダー (Header)                     |
+------------------------------------------+
|                                          |
|                                          |
|                                          |
| B. メイン表示エリア (Canvas)               |
|   (インタラクティブな要素を含む)            |
|   [ベースキー: C] ←世界観表示             |
|                                          |
|                                          |
+------------------------------------------+
| D. コントロールトリガー (Controls)         |
+------------------------------------------+

---- ボトムシート表示時の全体イメージ ----

+------------------------------------------+
| A. ヘッダー (Header)                     |
+------------------------------------------+
|                                          |
|                                          |
| B. メイン表示エリア (Canvas)               |
|   (インタラクティブな要素を含む)            |
|                                          |
|                                          |
+------------------------------------------+
| E. ボトムシート (縦スクロール式)         |
| +--------------------------------------+ |
| | 選択情報 + レイヤー設定 + ビュー設定   | |
| +--------------------------------------+ |
+------------------------------------------+

---- ボトムシートのみの詳細イメージ（縦スクロール式） ----

+------------------------------------------+
| ┌────────────────────────────────────────┐ |
| │ 選択情報パネル（常時表示）               │ |
| │ ベースキー: C Major                    │ |
| │ 選択要素: Dm7 (ii7)                   │ |
| └────────────────────────────────────────┘ |
| ┌─ レイヤー設定 ──────────────────── ▼ ┐ |  <-- アコーディオン (開)
| │                                      │ |
| │ スケール                [ ON / OFF ] │ |
| │   └ ディグリーネーム    [ ON / OFF ] │ |
| │   └ スケール音          [ ON / OFF ] │ |
| │                                      │ |
| │ コード                  [ ON / OFF ] │ |
| │   └ トライアド          [ ON / OFF ] │ |
| │   └ 7thコード         [ ON / OFF ] │ |
| └────────────────────────────────────────┘ |
| ┌─ ビュー設定 ──────────────────── ▲ ┐ |  <-- アコーディオン (閉)
| └────────────────────────────────────────┘ |
|                                          |
+------------------------------------------+
```

## 3. コンポーネント仕様

### 3.1. B: メイン表示エリア (Canvas)

- **役割**: `Hub & Layer` モデルの視覚的な表現領域。ユーザーの主たる操作対象となる。
- **主要機能**:
  - Hubコンポーネントを描画する。
    - B-1: 五度圏
    - B-2: クロマチックサークル
  - **現在のキー表示**: B-1（Hubコンポーネント）の真上に現在のベースキーを表示
    - 表示位置: Hubコンポーネントの上部中央
    - 表示形式: 「C Major」「F# Minor」など、キー名とモード名の組み合わせ
    - デフォルト値: 「C Major」（初期状態）
    - 更新タイミング: ユーザーがロングプレスでベースキーを変更した際に即座に更新
  - ユーザーによるキーやコードの選択（クリック/ホバー）を受け付ける。
  - レイヤー・コントローラーで有効化された情報を、Hubコンポーネント上にオーバーレイ描画する。

### 3.2. C: サイドパネル (Control & Information)

画面の左側に固定で配置されるコントロールパネル。Canvasに描画される内容を制御し、選択された要素に関する詳細情報を提示する。パネルは以下の3つのエリアで構成される。

#### C-1: 選択情報パネル (Information Panel)

- **役割**: Canvas上のインタラクションと、レイヤーコントローラーでの選択、その両方に応じて動的に情報を提示する。学習の「全体（概念）」と「部分（具体物）」をシームレスに繋ぐ、コンテキストに応じた情報ハブとして機能する。
- **ベースキーシステム**: 選択したキーを「世界観」として設定し、相対的な音楽理論情報を表示する。
  - **ロングプレス**: キーを長押しすることでベースキーとして設定
  - **タップ**: 通常タップでは選択要素として情報表示
  - **表示**: Canvas右上に現在のベースキーを「[ベースキー: C Major]」形式で常時表示
- **基本挙動**: パネルは、役割が異なる以下の2つのエリアに明確に分割される。これにより、ユーザーは「今見ている情報が何についてのものか」を直感的に区別できる。

##### C-1-1. レイヤー概念エリア (上段)

- **役割**: 現在アクティブになっているレイヤーが何であるかを簡潔に提示する。
- **表示トリガー**: ユーザーが「C-2: レイヤー・コントローラー」で何らかのレイヤー（トグルスイッチ）をONにした際に表示が更新される。
- **表示内容**:
  - **タイトル**: 最後にONにしたレイヤー名（例: `機能和声 (Functional Harmony)`）。
  - **サマリー**: その概念の目的や概要を端的に解説。
  - **キーワードリンク**: 解説が必要な専門用語（例: `平行調`）はハイパーリンクになっており、ライブラリ画面の該当項目へ遷移できる。
- **非表示条件**: 全てのレイヤーがOFFの場合、このエリアは非表示となる。

##### C-1-2. 選択要素エリア (下段)

- **役割**: ユーザーがCanvas上で具体的に選択した「モノ」が何であるかを詳しく説明する。ベースキーに対する相対的な情報として表示される。
- **表示トリガー**: ユーザーがCanvas上のキーやコードを**クリックまたはホバー**した時に、アニメーションを伴って情報が描画される。
- **表示内容**:
  - **要素名**: 選択したキーやコードの名前（例: `Dm7 (ii7)`）。ベースキーからの相対的な表記で表示。
  - **詳細情報**:
    - **キー選択時**: 調号、スケール構成音、平行調、同主調などの関連情報。ベースキーとの関係性も表示。
    - **コード選択時**: 構成音、機能（Tonic, Dominant等）、属するキーなどの分析情報。ベースキーのコンテキストで解釈。
  - **音声再生ボタン (🔊)**: 選択された要素に応じたサウンドを再生する。再生される音は、現在アクティブなビューに依存する（五度圏ビューでは**和音**、クロマチックビューでは**単音**など）。
  - **キーワードリンク**: 解説が必要な専門用語（例: `平行調`）はハイパーリンクになっており、ライブラリ画面の該当項目へ遷移できる。
- **非表示条件**: Canvas上で何も選択されていない場合、「要素を選択してください」というメッセージを表示するか、エリア自体を折りたたむ。

#### C-2: レイヤー・コントローラー (Layer Controller)

- **役割**: 選択されたHub（ビュー）の上に重ねる音楽理論の各レイヤーの可視性を制御する。アコーディオンの分類は常に固定だが、各レイヤーの視覚表現と音声フィードバックが、選択中のビューとレイヤーの役割（単音/和音）に応じて変化する。
- **基本挙動**:
  - 各アコーディオンはクリックで展開/折りたたみが可能。
  - 各項目の横には情報アイコン `(?)` を配置し、クリックでライブラリ画面の該当項目へ遷移する。
  - Hubの表示状態に応じて、一部の機能は非活性化（disabled）され、ユーザーに現在のビューで何が分析できるかを直感的に伝える。
  - **音声再生**: 基本ルールは以下の通り
    - アコーディオン1 (スケール) → 単音を再生
    - アコーディオン2 (コード) → 和音を再生
    - アコーディオン3 (関係性) → 機能に応じて単音または和音を再生

#### C-2-1. アコーディオン1: スケールレイヤー (Scale Layers): 音階（単音の集まり）の構造と特性を可視化する。

| コントロール要素   | UI種別         | 詳細と挙動                                                                                                                                                                                                                                       |
| :----------------- | :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **スケールの選択** | ドロップダウン | `メジャースケール` `ナチュラルマイナー`等を選択。<br>クリック/ホバーで構成音を単音で順番に再生。<br>**【五度圏】**: 五度圏】: 構成音に対応する外側のキー名（テキスト）のみをハイライト。<br>**【クロマチック】**: スケールの幾何学的な形を表示。 |
| **モードの表示**   | トグルスイッチ | ONにするとモード選択肢(`Ionian`, `Dorian`...)を表示。<br>クリック/ホバーで構成音を単音で順番に再生。<br>**【五度圏】**: "ブライトネス"に応じて色分け。<br>**【クロマチック】**: 各モードのユニークな形を可視化。                                 |

#### C-2-2. アコーディオン2: コードレイヤー (Chord Layers): 和音の内部構造と、調性内での役割を可視化する。

| コントロール要素                                                | UI種別           | 詳細と挙動                                                                                                                                                                                        |
| :-------------------------------------------------------------- | :--------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **ダイアトニックコード**                                        | トグルスイッチ   | 選択キーのダイアトニックコード群を表示。<br>クリック/ホバーでそのコードを和音で再生。<br>**【五度圏】**: 内外のセグメントを扇状にハイライト。<br>**【クロマチック】**: コード構成音をハイライト。 |
| ↳ **機能和声 (T/D/SD)**<br><small></small>                      | チェックボックス | 上記がONの時のみ有効。<br>五度圏上でコードを機能別に色分けする。                                                                                                                                  |
| **コード構成音の図形表示**<br><small>(クロマチック向け)</small> | トグルスイッチ   | ONにすると、クロマチックサークル上でコードの幾何学図形を描画。<br>転回形の表示もこれに連動させる。                                                                                                |

#### C-2-3. アコーディオン3: 関係性レイヤー (Relationship Layers): キー（調）やコードが、他の要素とどう関わり合っているかを可視化する。

| コントロール要素                                              | UI種別         | 詳細と挙動                                                                                                                                                                                             |
| :------------------------------------------------------------ | :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **近親調**<br><small>(五度圏向け)</small>                     | トグルスイッチ | 選択キーの近親調を五度圏上でハイライトする。<br>**クリックでそのキーの主和音を再生。**                                                                                                                 |
| **ドミナントモーション**<br><small>(五度圏向け)</small>       | トグルスイッチ | セカンダリー・ドミナント等の動きを矢印で可視化する。<br>**モーションの終着点の和音を鳴らす**と分かりやすいかも。                                                                                       |
| **トライトーン代理**                                          | トグルスイッチ | **【五度圏】**: 選択コード (V7) の代理関係にあるキーをハイライト。<br>**【クロマチック】**: 対角線上の代理コードをハイライト。<br>**どちらもクリックで和音を再生**し、響きが似ていることを体感させる。 |
| **ボイス・リーディング**<br><small>(クロマチック向け)</small> | トグルスイッチ | コード進行間の構成音の動きを線で結ぶ。<br>**音は鳴らさず、視覚的な繋がり**に集中させる。                                                                                                               |

#### C-3: ビュー・コントローラー (View Controller)

- **役割**: Canvasに描画するHub、すなわち音楽を分析するための「世界観（レンズ）」を切り替える。
- **UI仕様**:
  - `[ 五度圏 ]` と `[ クロマチック ]` の2つの選択肢を持つトグルスイッチ形式のUI。
  - 現在の選択が視覚的に強調され、レイヤーコントローラーの振る舞いを決定する。

## 4. モバイルでのレスポンシブ対応

### 4.1. 基本ルール

- **縦スクロール式統合UI:** PC版の3つのパネル（選択情報・レイヤー設定・ビュー設定）を単一の縦スクロール可能なボトムシートに統合する。
- **ベースキーシステム対応:** Canvas上でのロングプレス/タップ操作によるベースキー設定と情報表示に対応。
- **トリガー:**
  - **ボトムシート表示:** 画面下部に常時表示される専用のトリガーボタン（`D. Controls`）のタップによって表示される。
  - **要素選択:** メイン表示エリア (`B. Canvas`) 上のインタラクティブな要素の**タップ**で情報更新、**ロングプレス**でベースキー設定。

### 4.2. 縦スクロール式ボトムシートの構成 (`E. ボトムシート`)

- **表示トリガー:** ユーザーが `D. Controls` をタップする。
- **表示内容:** 以下の3つのセクションを縦に配列し、スクロール可能な単一UIとして提供:
  1. **選択情報パネル（常時表示）**: ベースキーと選択要素の情報を表示
  2. **レイヤー設定（アコーディオン）**: `C-2: レイヤー・コントローラー` の機能
  3. **ビュー設定（アコーディオン）**: `C-3: ビュー・コントローラー` の機能
- **アコーディオンUI仕様:**
  - セクションヘッダー部分をタップで開閉制御
  - 開いている状態では ▼ アイコン、閉じている状態では ▲ アイコンを表示
  - セクション間には明確な境界線とスペーシングを配置
  - 複数セクションの同時展開も可能
- **ベースキー操作:**
  - Canvas上の要素を**ロングプレス**することでベースキーとして設定
  - ベースキー設定時は「選択情報パネル」の表示が更新される
  - Canvas右上に現在のベースキーを「[ベースキー: C Major]」形式で常時表示

### 4.3. ボトムシートの非表示

以下のいずれかのアクションで、表示されているボトムシートを閉じることができる。

- ボトムシート上部に表示されるハンドル（グリッパー）を下にスワイプする。
- ボトムシート以外のエリア（Canvas領域など）をタップする。
- シート内に明示的な「閉じる」ボタンがあれば、それをタップする。

## 5. 画面連携 (ライブラリへのリンク)

本画面から「ライブラリ」画面へは、ユーザーの思考の流れを妨げない、以下の2種類の導線を提供する。

- **概念リンク**: ユーザーが「このレイヤー（理論）は何か？」を知りたい場合、レイヤー・コントローラーの `(?)` アイコンから、その理論の概要ページへ遷移する。
- **キーワードリンク**: ユーザーが「この単語は何か？」を知りたい場合、情報パネル内の専門用語（例: `平行調`）から、その用語の詳細ページへ遷移する。

## 6. コンポーネント一覧

以下に主要なコンポーネントの一覧を記載する。リンク先に詳細なコンポーネント設計書を記載。

- [CircleOfFifths](../../src/features/circle-of-fifths/README.md)
