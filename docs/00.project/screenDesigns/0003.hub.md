# 画面仕様詳細: インタラクティブ・ハブ

[<< 画面設計書（全体）に戻る](../02.screenDesign.md)

## 1. 画面概要

- **画面ID**: `SCR-001`
- **画面名**: インタラクティブ・ハブ
- **概要**: 本アプリケーションの中核をなす、インタラクティブな学習・分析画面。ユーザーは理論の「地図」を操作し、様々な情報「レイヤー」を重ねることで、音楽理論の構造を直感的に探求する。

## 2. 画面レイアウト

### 2.1 PC

ワイドスクリーンでの利用を前提とした3カラムレイアウトを採用。画面左側に操作コントロールを担当するコントロールパネルを配置し、画面中央にユーザーの主たる操作対象となるメイン表示エリア（Canvas）を確保。画面右側には選択要素や現在のキーに関する詳細情報を表示するインフォメーションパネルを配置する。

#### 画面構成イメージ

```
+--------------------------------------------------------------------------------------------------+
| A. グローバルヘッダーナビゲーション                                                              |
+--------------------------------------------------------------------------------------------------+
|                    |                                          |                               |
|   C. コントロール   |   B. メイン表示エリア (Canvas)          |   D. インフォメーション        |
|     パネル         |                                          |      パネル                   |
|                    |   +-------------------------------------+ |                             |
| +----------------+ |   |                                     | | +------------------------+ |
| | C-1: ビュー    | |   |        [現在のキー: C Major]            | | | D-1: 選択要素情報      | |
| | コントローラー | |   |    B-1: 五度圏 / B-2: クロマチック     | | |                        | |
| |                | |   |             サークル                   | | |  - 要素名              | |
| |  [ 五度圏 ]    | |   |        (Hub Component)                  | | |  - 詳細情報            | |
| |  [ クロマチック] | |   |                                     | | |  - 音声再生ボタン      | |
| +----------------+ |   +-------------------------------------+ | +------------------------+ |
|                    |                                          |                               |
| +----------------+ |                                          | +------------------------+ |
| | C-2: 将来の    | |                                          | | D-2: 現在のキー情報    | |
| | 拡張エリア     | |                                          | |                        | |
| |                | |                                          | |  - ベースキー表示      | |
| | - キー選択UI   | |                                          | |  - 関連情報            | |
| | - 設定・       | |                                          | |  - キーワードリンク    | |
| |   オプション等 | |                                          | |                        | |
| +----------------+ |                                          | +------------------------+ |
|                    |                                          |                               |
+--------------------------------------------------------------------------------------------------+

```

### 2.2. モバイル

モバイルデバイスでは、PC版とは異なり画面スペースが限られる。そのため、情報表示とコントロール機能を分離し、ユーザーが現在行いたいタスクに集中できるレイアウトを採用する。

具体的には、画面上部にメイン表示エリア（Canvas）を配置し、その下に情報表示パネルを常時表示する。PC版のコントロールパネル機能は **Vaulライブラリを使用したBottomSheet** に格納し、必要な時にアクセスできるように設計する。これにより、ビジュアルへの没入感を保ちながら、必要な情報とコントロールの両方にアクセス可能な環境を提供する。

#### 画面構成イメージ

```

---- 基本レイアウト ----

+------------------------------------------+
| A. グローバルヘッダーナビゲーション       |
+------------------------------------------+
|                                          |
|                                          |
| B. メイン表示エリア (Canvas)               |
|   [現在のキー: C Major]                   |
|    五度圏 / クロマチックサークル           |
|   (インタラクティブな要素を含む)            |
|                                          |
+------------------------------------------+
|                                          |
| C. インフォメーションパネル               |
|                                          |
|  ┌────────────────────────────────────┐   |
|  │ D-1: 選択要素情報                  │   |
|  │  - 要素名: Dm7 (ii7)              │   |
|  │  - 詳細情報                       │   |
|  │  - 音声再生ボタン                 │   |
|  └────────────────────────────────────┘   |
|                                          |
|  ┌────────────────────────────────────┐   |
|  │ D-2: 現在のキー情報                │   |
|  │  - ベースキー: C Major            │   |
|  │  - 関連情報                       │   |
|  └────────────────────────────────────┘   |
|                                          |
+------------------------------------------+

---- BottomSheet表示時 ----

+------------------------------------------+
| A. ヘッダー                              |
+------------------------------------------+
|                                          |
| B. Canvas (縮小表示)                     |
|                                          |
+------------------------------------------+
|                                          |
| C. インフォメーション (縮小)              |
|                                          |
+------------------------------------------+
| E. BottomSheet (Vaulライブラリ使用)      |
| ┌──────────────────────────────────────┐ |
| │ ハンドル (ドラッグ操作用)              │ |
| │ ┌─ Controller ──── × (閉じる) ┐     │ |
| │ │                              │     │ |
| │ │ ViewController                │     │ |
| │ │  [ 五度圏 ] [ クロマチック ]   │     │ |
| │ │                              │     │ |
| │ │ (将来の拡張エリア)              │     │ |
| │ │  - キー選択UI                 │     │ |
| │ │  - 設定・オプション           │     │ |
| │ └──────────────────────────────┘     │ |
| └──────────────────────────────────────┘ |
+------------------------------------------+

```

## 3. コンポーネント仕様

### 3.1. B: メイン表示エリア (Canvas)

- **役割**: `Hub & Layer` モデルの視覚的な表現領域。ユーザーの主たる操作対象となる。
- **主要機能**:
  - Hubコンポーネントを描画する。
    - B-1: 五度圏
    - B-2: クロマチックサークル
  - **現在のキー表示**: B-1（Hubコンポーネント）の真上に現在のベースキーを表示
    - 表示位置: Hubコンポーネントの上部中央
    - 表示形式: 「C Major」「F# Minor」など、キー名とモード名の組み合わせ
    - デフォルト値: 「C Major」（初期状態）
    - 更新タイミング: ユーザーがロングプレスでベースキーを変更した際に即座に更新
  - ユーザーによるキーやコードの選択（クリック/ホバー）を受け付ける。
  - レイヤー・コントローラーで有効化された情報を、Hubコンポーネント上にオーバーレイ描画する。

### 3.2. C: コントロールパネル (Controller Panel)

画面の左側に固定で配置されるコントロール専用パネル。Canvasに描画されるビューの切り替えと、将来的な拡張機能のためのコントロールUIを提供する。

#### C-1: ビューコントローラー (View Controller)

- **役割**: Canvasに描画するHub、すなわち音楽を分析するための「世界観（レンズ）」を切り替える。
- **UI仕様**:
  - `[ 五度圏 ]` と `[ クロマチック ]` の2つの選択肢を持つトグルスイッチ形式のUI。
  - 現在の選択が視覚的に強調され、レイヤーコントローラーの振る舞いを決定する。

#### C-2: 将来の拡張エリア

- **役割**: 今後の機能拡張に備えた予備エリア。
- **想定機能**:
  - キー選択UI
  - 設定・オプション機能
  - その他のコントロール要素

#### C-2: レイヤー・コントローラー (Layer Controller)

- **役割**: 選択されたHub（ビュー）の上に重ねる音楽理論の各レイヤーの可視性を制御する。アコーディオンの分類は常に固定だが、各レイヤーの視覚表現と音声フィードバックが、選択中のビューとレイヤーの役割（単音/和音）に応じて変化する。
- **基本挙動**:
  - 各アコーディオンはクリックで展開/折りたたみが可能。
  - 各項目の横には情報アイコン `(?)` を配置し、クリックでライブラリ画面の該当項目へ遷移する。
  - Hubの表示状態に応じて、一部の機能は非活性化（disabled）され、ユーザーに現在のビューで何が分析できるかを直感的に伝える。
  - **音声再生**: 基本ルールは以下の通り
    - アコーディオン1 (スケール) → 単音を再生
    - アコーディオン2 (コード) → 和音を再生
    - アコーディオン3 (関係性) → 機能に応じて単音または和音を再生

#### C-2-1. アコーディオン1: スケールレイヤー (Scale Layers): 音階（単音の集まり）の構造と特性を可視化する。

| コントロール要素   | UI種別         | 詳細と挙動                                                                                                                                                                                                                                       |
| :----------------- | :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **スケールの選択** | ドロップダウン | `メジャースケール` `ナチュラルマイナー`等を選択。<br>クリック/ホバーで構成音を単音で順番に再生。<br>**【五度圏】**: 五度圏】: 構成音に対応する外側のキー名（テキスト）のみをハイライト。<br>**【クロマチック】**: スケールの幾何学的な形を表示。 |
| **モードの表示**   | トグルスイッチ | ONにするとモード選択肢(`Ionian`, `Dorian`...)を表示。<br>クリック/ホバーで構成音を単音で順番に再生。<br>**【五度圏】**: "ブライトネス"に応じて色分け。<br>**【クロマチック】**: 各モードのユニークな形を可視化。                                 |

#### C-2-2. アコーディオン2: コードレイヤー (Chord Layers): 和音の内部構造と、調性内での役割を可視化する。

| コントロール要素                                                | UI種別           | 詳細と挙動                                                                                                                                                                                        |
| :-------------------------------------------------------------- | :--------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **ダイアトニックコード**                                        | トグルスイッチ   | 選択キーのダイアトニックコード群を表示。<br>クリック/ホバーでそのコードを和音で再生。<br>**【五度圏】**: 内外のセグメントを扇状にハイライト。<br>**【クロマチック】**: コード構成音をハイライト。 |
| ↳ **機能和声 (T/D/SD)**<br><small></small>                      | チェックボックス | 上記がONの時のみ有効。<br>五度圏上でコードを機能別に色分けする。                                                                                                                                  |
| **コード構成音の図形表示**<br><small>(クロマチック向け)</small> | トグルスイッチ   | ONにすると、クロマチックサークル上でコードの幾何学図形を描画。<br>転回形の表示もこれに連動させる。                                                                                                |

#### C-2-3. アコーディオン3: 関係性レイヤー (Relationship Layers): キー（調）やコードが、他の要素とどう関わり合っているかを可視化する。

| コントロール要素                                              | UI種別         | 詳細と挙動                                                                                                                                                                                             |
| :------------------------------------------------------------ | :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **近親調**<br><small>(五度圏向け)</small>                     | トグルスイッチ | 選択キーの近親調を五度圏上でハイライトする。<br>**クリックでそのキーの主和音を再生。**                                                                                                                 |
| **ドミナントモーション**<br><small>(五度圏向け)</small>       | トグルスイッチ | セカンダリー・ドミナント等の動きを矢印で可視化する。<br>**モーションの終着点の和音を鳴らす**と分かりやすいかも。                                                                                       |
| **トライトーン代理**                                          | トグルスイッチ | **【五度圏】**: 選択コード (V7) の代理関係にあるキーをハイライト。<br>**【クロマチック】**: 対角線上の代理コードをハイライト。<br>**どちらもクリックで和音を再生**し、響きが似ていることを体感させる。 |
| **ボイス・リーディング**<br><small>(クロマチック向け)</small> | トグルスイッチ | コード進行間の構成音の動きを線で結ぶ。<br>**音は鳴らさず、視覚的な繋がり**に集中させる。                                                                                                               |

#### C-3: ビュー・コントローラー (View Controller)

- **役割**: Canvasに描画するHub、すなわち音楽を分析するための「世界観（レンズ）」を切り替える。
- **UI仕様**:
  - `[ 五度圏 ]` と `[ クロマチック ]` の2つの選択肢を持つトグルスイッチ形式のUI。
  - 現在の選択が視覚的に強調され、レイヤーコントローラーの振る舞いを決定する。

### 3.3. D: インフォメーションパネル (Information Panel)

画面の右側に固定で配置される情報表示専用パネル。Canvas上のインタラクションに応じて動的に情報を提示し、学習の「全体（概念）」と「部分（具体物）」をシームレスに繋ぐ。

#### D-1: 選択要素情報エリア (Selected Element Info)

- **役割**: ユーザーがCanvas上で具体的に選択した「モノ」が何であるかを詳しく説明する。ベースキーに対する相対的な情報として表示される。
- **表示トリガー**: ユーザーがCanvas上のキーやコードを**クリックまたはホバー**した時に、アニメーションを伴って情報が描画される。
- **表示内容**:
  - **要素名**: 選択したキーやコードの名前（例: `Dm7 (ii7)`）。ベースキーからの相対的な表記で表示。
  - **詳細情報**:
    - **キー選択時**: 調号、スケール構成音、平行調、同主調などの関連情報。ベースキーとの関係性も表示。
    - **コード選択時**: 構成音、機能（Tonic, Dominant等）、属するキーなどの分析情報。ベースキーのコンテキストで解釈。
  - **音声再生ボタン (🔊)**: 選択された要素に応じたサウンドを再生する。再生される音は、現在アクティブなビューに依存する（五度圏ビューでは**和音**、クロマチックビューでは**単音**など）。
  - **キーワードリンク**: 解説が必要な専門用語（例: `平行調`）はハイパーリンクになっており、ライブラリ画面の該当項目へ遷移できる。
- **非表示条件**: Canvas上で何も選択されていない場合、「要素を選択してください」というメッセージを表示するか、エリア自体を折りたたむ。

#### D-2: 現在のキー情報エリア (Current Key Info)

- **役割**: 現在設定されているベースキーの詳細情報と関連する音楽理論情報を表示する。
- **ベースキーシステム**: 選択したキーを「世界観」として設定し、相対的な音楽理論情報を表示する。
  - **ロングプレス**: キーを長押しすることでベースキーとして設定
  - **タップ**: 通常タップでは選択要素として情報表示
  - **表示**: Canvas上部に現在のベースキーを「[ベースキー: C Major]」形式で常時表示
- **表示内容**:
  - **ベースキー表示**: 現在設定されているベースキーの名前とモード
  - **関連情報**: スケール構成音、ダイアトニックコード、関連調などの基本情報
  - **キーワードリンク**: 専門用語はライブラリ画面の該当項目へのリンク

## 4. モバイルでのレスポンシブ対応

### 4.1. 基本ルール

- **情報・コントロール分離:** 情報表示パネルは常時表示し、コントロール機能は必要時アクセスできるBottomSheetに格納する。
- **Vaulライブラリ採用:** BottomSheetはVaulライブラリを使用し、ドラッグ対応の高品質なユーザー体験を提供する。
- **ベースキーシステム対応:** Canvas上でのロングプレス/タップ操作によるベースキー設定と情報表示に対応。
- **レスポンシブレイアウト:** 画面サイズに応じてコンテンツが適切にリサイズされる。

### 4.2. BottomSheet仕様 (`E. BottomSheet`)

#### 4.2.1. 技術仕様

- **ライブラリ:** Vaulライブラリを使用したドラッグ対応BottomSheet
- **スナップポイント:** 3段階（6%、50%、85%）
- **操作性:**
  - ドラッグハンドルによる直感的な操作
  - 背景オーバーレイタップで最小化
  - 動的ビューポート対応（h-dvh）

#### 4.2.2. 表示コンテンツ

- **メインコンテンツ:** PC版のControllerPanelをモバイル用にカスタマイズ
  - ViewController（ビュー切り替え）
  - 将来の拡張機能用スペース
- **ヘッダー:**
  - ドラッグハンドル
  - タイトル表示（"Controller"）
  - 閉じるボタン（×アイコン）

#### 4.2.3. 表示・非表示の制御

- **表示トリガー:** 画面下部の専用トリガーボタンタップ（実装予定）
- **非表示方法:**
  - ハンドルの下方向スワイプ
  - 背景オーバーレイタップ
  - 閉じるボタンタップ
  - Canvas領域タップ

### 4.3. インフォメーションパネルの常時表示

- **配置:** Canvas下部に固定表示
- **コンテンツ:** PC版と同等の情報表示機能
  - D-1: 選択要素情報
  - D-2: 現在のキー情報
- **スクロール:** 縦スクロール対応で長いコンテンツにも対応

## 5. 画面連携 (ライブラリへのリンク)

本画面から「ライブラリ」画面へは、ユーザーの思考の流れを妨げない、以下の2種類の導線を提供する。

- **概念リンク**: ユーザーが「このレイヤー（理論）は何か？」を知りたい場合、レイヤー・コントローラーの `(?)` アイコンから、その理論の概要ページへ遷移する。
- **キーワードリンク**: ユーザーが「この単語は何か？」を知りたい場合、情報パネル内の専門用語（例: `平行調`）から、その用語の詳細ページへ遷移する。

## 6. コンポーネント一覧

以下に主要なコンポーネントの一覧を記載する。リンク先に詳細なコンポーネント設計書を記載。

- [CircleOfFifths](../../src/features/circle-of-fifths/README.md)
