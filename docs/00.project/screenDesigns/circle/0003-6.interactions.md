# Hub画面: 横断的インタラクション仕様

[<< Hub画面設計トップに戻る](../0003.hub.md)

## 1. 役割

このドキュメントでは、単一のコンポーネントに閉じず、複数のコンポーネントにまたがって発生する、アプリケーションの横断的なインタラクションについて定義します。

---

## 2. ベースキーシステム

アプリケーション全体の音楽的な文脈（コンテキスト）を決定する、最も重要なインタラクションです。

- **目的**:
  特定のキーを「世界の中心（トニック）」として設定し、他のすべての音楽的要素を、そのキーとの相対的な関係性（ディグリーネーム等）で表示・分析できるようにします。

- **インタラクションフロー**:

| ユーザー操作 (入力)                                   | システムの反応 (出力/フィードバック)                                                                                                                                                                                                                                                              |
| :---------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. Canvas上の任意のキーを**ロングプレス**する。       | - そのキーが新しい「ベースキー」として`currentKeyStore`に保存される。<br>- Canvas上部のベースキー表示が更新される。<br>- インフォメーションパネルの「現在のキー情報」エリアが更新される。<br>- Canvas上の他の全要素の表示が、新しいベースキーからの相対的な関係性に基づいて再計算・再描画される。 |
| 2. Canvas上のキーを通常の**タップ（クリック）**する。 | - ベースキーは変更されない。<br>- タップされた要素の情報が「選択要素情報」としてインフォメーションパネルに表示される。                                                                                                                                                                            |

---

## 3. 画面連携 (ライブラリへのリンク)

ユーザーの「知りたい」という探求心をサポートするため、Hub画面からライブラリ画面へ、コンテキストに応じたシームレスな画面遷移を提供します。

| リンク種別           | 目的 (ユーザーの思考)              | UI上の場所                                                               | 遷移先                                                 |
| :------------------- | :--------------------------------- | :----------------------------------------------------------------------- | :----------------------------------------------------- |
| **概念リンク**       | 「このレイヤー（理論）とは何か？」 | コントロールパネルの各レイヤー項目の横にある情報アイコン `(?)`           | ライブラリ画面の、その**理論の概要**を説明するページ。 |
| **キーワードリンク** | 「この専門用語の意味は何か？」     | インフォメーションパネル内に表示される下線付きの専門用語（例: `平行調`） | ライブラリ画面の、その**用語を解説**する詳細ページ。   |

---

## 4. コード進行操作（アニメーション）

ユーザーがコード進行の響きや構造を、視覚と聴覚の両面から直感的に理解するための機能です。

- **目的**:
  特定のキーから理論的に導かれる典型的な進行（五度進行、裏コードなど）を、アニメーションと音声で提示し、音楽的な文脈の変化を体感させます。

- **UI要素**:

  - コントロールパネル > Chordレイヤー > 詳細設定（アコーディオン展開時）
  - キーが選択されている（Selected Keyが存在する）状態でのみ、再生ボタンが表示されます。

- **インタラクションフロー**:

| ユーザー操作                                          | システムの反応 (アニメーションと音声)                                                                                                                                                                                                                                                                                                                                                                                        |
| :---------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Play 5th Progression**<br>(五度進行ボタン押下)      | 1. **起点コード再生**: 現在選択中のコードの音が鳴る。<br>2. **視覚アニメーション**: 現在のキーから反時計回り（IV方向、ドミナントモーション的解決先）へ、矢印が伸びるアニメーションが2秒間かけて表示される。<br>3. **解決コード再生**: 矢印の到達点のコードの音が鳴り、システム上の「選択中のキー」がそのコードに更新される。<br>※ マイナーキーの場合も、平行調のメジャーキーと同じ視覚的位置関係でアニメーションが行われる。 |
| **Play Tritone Substitution**<br>(裏コードボタン押下) | 1. **起点コード再生**: 現在選択中のコードの音が鳴る。<br>2. **視覚アニメーション**: 現在のキーから対角線上（増四度/減五度）の位置へ、矢印が伸びるアニメーションが表示される。<br>3. **解決コード再生**: 到達点のコードの音が鳴り、「選択中のキー」が更新される。                                                                                                                                                             |
