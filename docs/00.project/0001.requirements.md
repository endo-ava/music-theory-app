# 要件定義書

## 1. アプリケーション概要 (What)

本アプリケーションは、複雑な音楽理論の概念と、その相互関係を探求するための**インタラクティブ・ビジュアライゼーションツール**である。視覚的なグラフィック表現と聴覚的なフィードバックを組み合わせることで、抽象的な理論を具体的で感覚的な体験へと転換。これにより、学習者が知識を暗記するのではなく、音楽の構造的な美しさを**発見し、本質的な理解に至る**ことを支援する。

## 2. 背景と目的

### 2.1 背景 (Background)

従来の音楽理論学習は、書籍やWebサイトによる静的なテキスト・図版、あるいは動画による受動的な視聴が主流であった。これらの方法は、各概念間の動的な関係性や、理論が実際の音としてどう響くのかを直感的に結びつける体験が困難であるといいう課題がある。結果として、学習者は知識が断片化しやすく、応用的な思考に至りにくい状況に置かれている。

### 2.2 目的 (Purpose)

本アプリケーションは、上記の課題を解決するため、以下の目的を達成する。

- **体系の可視化:** 音楽理論の体系的な構造をネットワークとして可視化し、ユーザーが知識の全体像を直感的に把握できるようにする。
- **感覚的学習の実現:** ユーザーのアクションに即応する視覚・聴覚フィードバックを提供し、能動的で感覚的な学習体験を創出する。
- **本質的理解の支援:** 理論学習者が抱きがちな「知識の断片化」を防ぎ、応用力に繋がる本質的な理解を支援する。
- **インタラクティブ・リファレンス:** 一度習得した知識を再確認・探求するための、インタラクティブな備忘録（リファレンス）としての役割を果たす。

## 3. コアコンセプト / 設計思想

本アプリケーションは、単なる音楽理論の知識を提供するツールではなく、理論の背後にある**構造的な美しさ**と**概念間の相互関係**をユーザーが直感的に発見・体験するためのインタラクティブな環境である。以下の4つの思想を設計の核とする。

### 3.1 統合的・体系的理解の促進

音楽理論を、暗記すべき断片的なルールの集合としてではなく、各概念が相互に連携し合う一つの大きな**体系（システム）**として提示する。ユーザーが個々の知識の「点」を結びつけ、全体像としての「線」や「面」を自ら描き出せるよう導くことで、本質的な構造理解を促す。

### 3.2 関係性の可視化 (Visualizing Connections)

スケール、コード、モードといった一見すると個別の概念が、実際にはどのように関連し合っているのかを**視覚的に**明らかにする。特に、「五度圏」を情報構造の中心的な**ハブ**として位置づけ、そこから各概念がどのように派生・接続されているかをグラフィカルに示す。

### 3.3 感覚的インタラクションによる学習 (Sensory Interaction)

抽象的な理論を、具体的な**感覚的体験**へと転換させる。

- **視覚 (Visual):** インタラクティブなUIとアニメーションを通じ、コードの構成やスケールのパターンを直感的な「形」として認識させる。
- **聴覚 (Auditory):** ユーザーのアクションに対し、即座に音によるフィードバック（単音、和音）を返すことで、視覚情報と聴覚情報を結びつけ、理論の響きを身体で理解させる。

## 4. 想定ユーザー (Who)

本アプリケーションは、以下のユーザーをターゲットとして設計する。

### 4.1 プライマリーターゲット：知識の探求者

- **属性:** 音楽理論の基本的な用語は知っているが、知識が点在しており、それらを実践で活用することに課題を感じている中級者。
- **課題:** 応用が効かず、知識を補強・整理するための信頼できる情報源を探している。理論の「なぜ」を深く理解したい。
- **提供価値:** インタラクティブな探求と、辞書的な知識参照をシームレスに往復する学習体験。知識の繋がりを発見し、体系的な理解を構築する手助けをする。

### 4.2 セカンダリーターゲット：好奇心旺盛な初心者

- **属性:** 音楽に興味を持ち、理論を学び始めたいと考えているが、何から手をつけて良いか分からない初学者。
- **課題:** 専門用語の多さや、理論の抽象的で難解なイメージに学習への一歩を踏み出せないでいる。
- **提供価値:** 物語形式の導入コンテンツや、ゲームのような感覚的な操作を通じて、専門用語に頼らずに音楽理論の世界にソフトランディングできる機会を提供する。

## 4. 使用技術

本アプリケーション開発に使用する主要な技術スタック、および開発・インフラ環境は以下の通りである。

### 4.1 主要技術スタック

アプリケーションを直接構成するフレームワーク、ライブラリ。

| 技術          | カテゴリ       | バージョン | 用途                                     |
| :------------ | :------------- | :--------- | :--------------------------------------- |
| Next.js       | フレームワーク | 15.x       | アプリケーション基盤、ルーティング、SSR  |
| React         | UIライブラリ   | 19.x       | コンポーネントベースのUI構築             |
| TypeScript    | 言語           | 5.x        | 型安全性と開発効率の向上                 |
| Tailwind CSS  | スタイリング   | 4.x        | ユーティリティファーストなUIスタイリング |
| Framer Motion | アニメーション | 12.x       | 流麗なUIアニメーションの実装             |
| Tone.js       | 音声処理       | 15.x       | Web Audio APIラッパー、音声再生制御      |
| Zustand       | 状態管理       | 5.x        | グローバルな状態管理                     |

### 4.2 開発・インフラ環境

開発効率の向上、コード品質の担保、およびデプロイメントに使用するツール・サービス。

| 技術        | カテゴリ            | 用途                                                 |
| :---------- | :------------------ | :--------------------------------------------------- |
| Cursor      | エディタ            | AI駆動開発、コーディング                             |
| Git         | バージョン管理      | ソースコードの変更履歴管理                           |
| Vercel      | CI/CD, ホスティング | デプロイメントと本番環境の提供                       |
| ESLint      | コード品質          | 静的コード解析、コード品質の担保                     |
| Prettier    | コードフォーマッタ  | コードスタイルの自動整形                             |
| Husky       | Git Hooks           | コミット前のチェック（Lint, Format）自動化           |
| lint-staged | Git Hooks           | ステージングされたファイルのみを対象としたLinter実行 |

## 5. 機能要件

本アプリケーションの機能要件を以下に定義する。

### 5.1 機能カテゴリ

要件IDの百の位は、以下の機能カテゴリを示す。

- **F1xx: 表示 (View)** - 画面要素の静的な描画に関する要件
- **F2xx: 操作 (Interaction)** - ユーザーのアクションに対するシステムの応答に関する要件
- **F3xx: 情報 (Information)** - 音楽理論に基づいた情報の処理・表示に関する要件
- **F4xx: 音声 (Audio)** - 音声の再生・制御に関する要件
- **F5xx: UI/UX** - 全体的なユーザー体験の向上に関する要件
- **F6xx: コンテンツ (Contents)** - 静的な学習コンテンツに関する要件
- **F7xx: ユーザー入力 (Input)** - ユーザーからの情報入力に関する要件

### 5.2 機能要件一覧

優先度はMoSCoW分析（Must, Should, Could, Won't）に基づき評価する。

| 要件ID   | カテゴリ     | 機能概要                         | 詳細                                                                                                                                   | 優先度     |
| :------- | :----------- | :------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------- | :--------- |
| **F101** | 表示         | **五度圏の基本描画**             | ・12のキー（メジャー/マイナー）を持つ五度圏をSVGで描画する。\<br\>・各キーエリア（メジャー、マイナー、調号）を明確に分割して表示する。 | **Must**   |
| **F201** | 操作         | **キー選択機能**                 | ・ユーザーが任意のキーエリア（メジャー/マイナー）をクリックまたはタップして選択できる。                                                | **Must**   |
| **F202** | 操作         | **インタラクティブな視覚効果**   | ・ホバー、クリック/タップ時に、キーエリアのスケールや色を変更するなどの視覚的なフィードバックを返す。                                  | **Should** |
| **F301** | 情報         | **選択キー情報の表示**           | ・選択されたキーの基本情報（キー名、調性、平行調など）を表示するエリアを設ける。                                                       | **Must**   |
| **F302** | 情報         | **関連理論情報の表示**           | ・選択キーのダイアトニックコードなど、関連する基本的な理論情報を表示する。                                                             | **Should** |
| **F303** | 情報         | **関連スケールの表示**           | ・選択キーの基本的なスケール（メジャースケール、ナチュラルマイナースケール等）を視覚的に表示する。                                     | **Should** |
| **F304** | 情報         | **高度な音楽理論の可視化**       | ・モーダルインターチェンジや転調など、より高度な音楽理論をインタラクティブに表示・解説する機能。                                       | **Won't**  |
| **F401** | 音声         | **基本和音の再生**               | ・選択されたキーの基本和音（メジャートライアド、マイナートライアド）を再生する。                                                       | **Must**   |
| **F402** | 音声         | **音色の切り替え機能**           | ・再生される音声の音色を、正弦波からピアノなどに変更できる機能。                                                                       | **Could**  |
| **F501** | UI/UX        | **高度なUIアニメーション**       | ・情報の表示/非表示や画面遷移に、よりリッチなアニメーションを実装する。                                                                | **Could**  |
| **F601** | コンテンツ   | **用語解説機能**                 | ・音楽理論の各用語を解説する静的なページ群を作成する。\<br\>・インタラクティブ機能から関連用語へリンクする。                           | **Won't**  |
| **F602** | コンテンツ   | **物語形式の学習コンテンツ**     | ・ピタゴラス音律の発見など、理論の歴史や背景をストーリー仕立てで学べるコンテンツ。                                                     | **Won't**  |
| **F701** | ユーザー入力 | **ユーザーによる情報入力・分析** | ・ユーザーが任意のコード進行を入力し、それを分析・可視化する機能。                                                                     | **Won't**  |

## 6. 非機能要件

アプリケーションの品質を保証するため、以下の非機能要件を定義する。

| カテゴリ                                  | 要件                           | 目標・指標                                                                                                                                                                                                                                    |
| :---------------------------------------- | :----------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ユーザビリティ**\<br\>(Usability)       | **直感的な操作性**             | ・主要機能（キー選択、情報表示）は、初めて利用するユーザーがチュートリアルなしで操作できる。\<br\>・専門用語を知らなくても、視覚的な手がかりで意味が推測できるUIデザイン。                                                                    |
|                                           | **アクセシビリティ**           | ・WCAG 2.1のAAレベルに準拠する。\<br\>・キーボードのみですべてのインタラクティブ要素の操作が可能。\<br\>・スクリーンリーダーによる主要な情報の読み上げに対応する。                                                                            |
|                                           | **レスポンシブデザイン**       | ・PC（デスクトップ）での利用を主要ターゲットとしつつ、タブレットおよびスマートフォンでもレイアウト崩れなく、主要機能が利用可能であること。                                                                                                    |
| **パフォーマンス**\<br\>(Performance)     | **高速なページロード**         | ・Google PageSpeed Insightsにおいて、モバイル・デスクトップ共にパフォーマンススコア80以上を目指す。\<br\>・LCP (Largest Contentful Paint) を2.5秒未満に維持する。                                                                             |
|                                           | **スムーズなインタラクション** | ・UIアニメーションは60fpsを維持し、ユーザーの体感としてカクつきがないこと。\<br\>・ユーザー操作に対するUIの応答時間は200ms未満とする。                                                                                                        |
|                                           | **リアルタイムな音声再生**     | ・ユーザーのアクションから音声が再生されるまでの遅延を100ms未満に抑える。                                                                                                                                                                     |
| **信頼性**\<br\>(Reliability)             | **アプリケーションの安定稼働** | ・致命的なエラーによるアプリケーションのクラッシュが発生しないこと。\<br\>・Vercelによるホスティング環境で、稼働率99.9%以上を目指す。                                                                                                         |
|                                           | **適切なエラーハンドリング**   | ・想定外の操作やデータ不整合が発生した場合、アプリケーションが停止せず、ユーザーに状況を伝える適切なメッセージを表示する。                                                                                                                    |
| **保守性・拡張性**\<br\>(Maintainability) | **高いコード品質**             | ・コンポーネントは機能ごとに適切に分割（関心の分離）され、再利用性が高い状態を維持する。\<br\>・TypeScriptの`strict`モードを遵守し、`any`型の使用を原則禁止する。\<br\>・ESLint、Prettierによる静的解析およびフォーマット規約をCIで強制する。 |
|                                           | **容易な機能拡張**             | ・新しい音楽理論の概念や学習コンテンツの追加が、既存のコードへの大きな変更なしに行える疎結合なアーキテクチャを維持する。                                                                                                                      |
| **互換性**\<br\>(Compatibility)           | **ブラウザ互換性**             | ・最新版のGoogle Chrome, Firefox, Safari, Microsoft Edgeで全ての機能が正常に動作すること。                                                                                                                                                    |
| **セキュリティ**\<br\>(Security)          | **基本的なセキュリティ対策**   | ・ユーザー認証やデータベースアクセスは現時点でスコープ外だが、XSS（クロスサイトスクリプティング）等の基本的な脆弱性が混入しないよう留意する。                                                                                                 |

## 7. 参考
