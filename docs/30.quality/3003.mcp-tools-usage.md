# MCP Tools 活用ガイドライン

Claude Code での MCP (Model Context Protocol) ツール群の効率的な活用方法について説明する。

## Playwright MCP - ブラウザテスト・スクリーンショット

### 基本方針

- 常に全画面（full_page: true）でスクリーンショットを取得する
- ファイルサイズを最小化するため、品質とサイズを調整する
- レスポンストークンサイズを制限内に収める

### スクリーンショット実行時の指示

1. まずビューポートサイズを設定。何も指示が無ければ、1920x1080と設定する：

```javascript
mcp__playwright__browser_resize(width: 1920, height: 1080)
```

2. 以下の設定で全画面スクリーンショットを取得：

```javascript
mcp__playwright__browser_take_screenshot(
  filename: "[descriptive_name].jpg",
  fullPage: true,
  type: "jpeg"
)
```

### 一般的な画面サイズ設定

例えば「スマホサイズで」と指示されたら下記のスマートフォンのサイズを設定する：

- **スマートフォン（一般的なサイズ）**
  `mcp__playwright__browser_resize(width: 360, height: 800)`
- **タブレット（10インチ）**
  `mcp__playwright__browser_resize(width: 800, height: 1280)`
- **FHD**
  `mcp__playwright__browser_resize(width: 1920, height: 1080)`
- **WQHD (2K)**
  `mcp__playwright__browser_resize(width: 2560, height: 1440)`
- **4K**
  `mcp__playwright__browser_resize(width: 3840, height: 2160)`
- **ウルトラワイド**
  `mcp__playwright__browser_resize(width: 3440, height: 1440)`

## Serena MCP - コード分析・編集

### 基本方針

- **コードベースの理解・探索にはSerena MCPを積極的に活用する**
- ファイル全体を読む前に、まずシンボル概要やパターン検索で効率的に情報収集する
- 大きなファイルを読む必要がある場合は、事前にSerenaの概要ツールで構造を把握する

### 優先的にSerenaを使用すべき場面

#### 1. コードベース探索時

- `mcp__serena__get_symbols_overview` でディレクトリやファイルの構造把握
- `mcp__serena__find_symbol` で特定のクラス・関数・型の検索
- `mcp__serena__search_for_pattern` でパターンマッチング検索

#### 2. コード編集時

- `mcp__serena__replace_symbol_body` でシンボル全体の置換
- `mcp__serena__insert_after_symbol` / `mcp__serena__insert_before_symbol` でコード挿入
- 従来のEditツールは部分的な置換のみで使用

#### 3. リファクタリング時

- `mcp__serena__find_referencing_symbols` で参照箇所の特定
- 依存関係の理解と安全な変更の実施

### トークン効率化のために

- ファイル全体読み込み（Readツール）は最後の手段とする
- まずSerenaの概要・検索ツールで必要な部分のみを特定してから読み込む
- 同じファイルを複数回読まないよう、Serenaの情報を活用する

### メモリ活用

- プロジェクト情報はSerenaメモリに保存済み
- `mcp__serena__read_memory` で必要な情報を効率的に取得
- 新しい知見は `mcp__serena__write_memory` で継続的に蓄積

## 使用上の注意事項

### Serenaツール使用時

1. **onboarding状態の確認**

   ```javascript
   mcp__serena__check_onboarding_performed();
   ```

   初回使用時は必ずonboardingを確認する

2. **情報収集後の整理**

   ```javascript
   mcp__serena__think_about_collected_information();
   ```

   検索・分析完了後は必ず実行する

3. **タスク完了確認**
   ```javascript
   mcp__serena__think_about_whether_you_are_done();
   ```
   作業完了時の最終確認で実行する

### Playwrightツール使用時

1. **ブラウザの初期化確認**

   ```javascript
   mcp__playwright__browser_install();
   ```

   エラー時のブラウザインストール

2. **スナップショット取得**
   ```javascript
   mcp__playwright__browser_snapshot();
   ```
   アクセシビリティ情報を含む構造把握に有効

## トラブルシューティング

### Serena関連

- シンボルが見つからない場合：`substring_matching: true` オプションを使用
- 大量の結果が返される場合：`relative_path` で範囲を限定
- パフォーマンス問題：`max_answer_chars` で出力制限

### Playwright関連

- ブラウザが起動しない：`mcp__playwright__browser_install()` を実行
- スクリーンショットが大きすぎる：JPEG形式・品質調整を使用
- 要素が見つからない：`mcp__playwright__browser_snapshot()` で構造確認
