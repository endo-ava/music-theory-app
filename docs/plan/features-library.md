# Library機能 実装計画書

## 1. 全体フェーズ定義

Library（Music Theory Atlas）の実装を、以下の6つのフェーズに分割して進行する。

- **Phase 1: 基盤とデータ構造 (Foundation & Data)**
  - アプリケーションの骨格と、表示すべき「地図データ」の定義を行う。
- **Phase 2: アトラス描画コア (Atlas Core Rendering)**
  - 地図（Canvas）上にノードや領域を描画する基本機能を実装する。
- **Phase 3: インタラクションとナビゲーション (Interaction & Navigation)**
  - ズーム、パン、選択といった、地図を「操作する」機能を実装する。
- **Phase 4: 詳細情報表示 (Detail Information)**
  - 選択されたノードの詳細情報（右パネル/詳細ページ）を表示する機能を実装する。
- **Phase 5: 検索とフィルタリング (Search & Discovery)**
  - 膨大なデータから目的の項目を見つけるための検索・絞り込み機能を実装する。
- **Phase 6: 感覚的体験の統合 (Sensory Experience)**
  - 音声再生やアニメーションを追加し、体験の質を高める。

---

## 2. タスク分解と依存関係図

### Phase 1: 基盤とデータ構造 (Foundation & Data)

- **[T01-01] データスキーマと初期データセットの定義**

  - **説明**: ノード（Pitch, Scale, Chord, Key）とエッジ（関係性）、およびドメイン（領域）のデータ構造を定義し、モックデータを作成する。
  - **Definition of Done**: 全種類のノードを含むJSON形式等のデータセットが存在し、読み込み可能であること。
  - **Pre-requisite**: なし

- **[T01-02] 画面レイアウトの骨格作成**
  - **説明**: ヘッダー、サイドバー領域、メインキャンバス領域、詳細パネル領域の配置枠を作成する。
  - **Definition of Done**: PC/Mobileそれぞれの基本レイアウト枠が表示され、レスポンシブに切り替わること。
  - **Pre-requisite**: なし

### Phase 2: アトラス描画コア (Atlas Core Rendering)

- **[T02-01] 座標系とビューポートの実装**

  - **説明**: 無限に広がる（あるいは固定された）空間を表示するための「窓（ビューポート）」を作成し、座標管理の仕組みを作る。
  - **Definition of Done**: 画面上に描画領域が確保され、論理座標(x,y)を指定して要素を配置できる状態になること。
  - **Pre-requisite**: T01-02

- **[T02-02] ノードとドメインの静的描画**

  - **説明**: 定義されたデータに基づき、画面上に点（ノード）と背景領域（ドメイン）を表示する。
  - **Definition of Done**: モックデータに含まれる全ノードが、指定された座標に表示されていること。
  - **Pre-requisite**: T01-01, T02-01

- **[T02-03] エッジ（関係線）の描画**
  - **説明**: ノード間のつながりを示す線を描画する。
  - **Definition of Done**: 関連するノード同士が線で結ばれて表示されること。
  - **Pre-requisite**: T02-02

### Phase 3: インタラクションとナビゲーション (Interaction & Navigation)

- **[T03-01] ズームとパン操作の実装**

  - **説明**: 地図の拡大縮小（ズーム）と移動（パン）を可能にする。
  - **Definition of Done**: マウスドラッグ/ホイール（PC）、スワイプ/ピンチ（Mobile）で視点を変更できること。
  - **Pre-requisite**: T02-02

- **[T03-02] ノード選択機能の実装**
  - **説明**: ノードをクリック/タップした際の「選択状態」を管理し、視覚的フィードバック（ハイライト等）を与える。
  - **Definition of Done**: ノードをクリックすると色が変わり、システム内部で「現在選択中のノードID」が保持されること。
  - **Pre-requisite**: T02-02

### Phase 4: 詳細情報表示 (Detail Information)

- **[T04-01] 詳細パネル/ページの表示制御**

  - **説明**: ノード選択時に、PCでは右パネルのスライドイン、Mobileでは詳細ページへの遷移（またはモーダル表示）を行う。
  - **Definition of Done**: [T03-02]でノードを選択すると、詳細領域が表示され、解除すると非表示になること。
  - **Pre-requisite**: T01-02, T03-02

- **[T04-02] 詳細コンテンツのレンダリング**

  - **説明**: 選択されたノードの属性（タイトル、説明、構成音など）を詳細パネル内に表示する。
  - **Definition of Done**: 選択したノードによって異なるテキスト情報が正しく表示されること。
  - **Pre-requisite**: T04-01

- **[T04-03] 視覚的プレビュー（鍵盤・五度圏）の実装**
  - **説明**: 詳細パネル内に、そのノードに対応する図解（鍵盤図や五度圏位置）を表示する。
  - **Definition of Done**: Scaleなら鍵盤、Keyなら五度圏など、タイプに応じた図が表示されること。
  - **Pre-requisite**: T04-02

### Phase 5: 検索とフィルタリング (Search & Discovery)

- **[T05-01] サイドバーフィルタの実装**

  - **説明**: カテゴリやドメインごとにノードの表示/非表示を切り替える機能を実装する。
  - **Definition of Done**: チェックボックスを操作すると、対応するノード群が画面から消える/現れること。
  - **Pre-requisite**: T02-02

- **[T05-02] 検索機能とインデックス化**

  - **説明**: キーワード入力によりノードを検索し、候補リストを表示する。
  - **Definition of Done**: 文字入力に対し、合致するノード名がリストアップされること。
  - **Pre-requisite**: T01-01

- **[T05-03] 検索結果へのジャンプ**
  - **説明**: 検索結果を選択した際、そのノードが中心に来るように視点を移動し、選択状態にする。
  - **Definition of Done**: 検索リストをクリックすると、Canvasが該当箇所へ移動し、詳細パネルが開くこと。
  - **Pre-requisite**: T03-01, T05-02

### Phase 6: 感覚的体験の統合 (Sensory Experience)

- **[T06-01] 音声再生機能の統合**

  - **説明**: 詳細パネル内の再生ボタン、またはノード操作時に音を鳴らす。
  - **Definition of Done**: 再生ボタン押下で、そのコードやスケールの音が正しく再生されること。
  - **Pre-requisite**: T04-02

- **[T06-02] アニメーションによる演出**
  - **説明**: パネルの出現、視点移動、ノードの光り方などに動きをつける。
  - **Definition of Done**: 各操作に対して定義された秒数でのスムーズな遷移が確認できること。
  - **Pre-requisite**: 各機能実装完了後

---

## 3. 推奨実行フロー (Execution Roadmap)

効率と手戻り防止を考慮した実行順序は以下の通り。

1.  **Step 1**: **[T01-01] データ定義** を最優先で完了させる。これが全ての源泉となる。
2.  **Step 2**: **[T01-02] レイアウト** と **[T02-01] 座標系** を並行して進める。
3.  **Step 3**: **[T02-02] ノード描画** を実装し、地図が見える状態にする。
4.  **Step 4**: **[T03-01] ズーム/パン** と **[T03-02] 選択** を実装し、触れる状態にする。
5.  **Step 5**: ここで分岐可能。
    - **Team A (UI/Logic)**: **[T04-01]** → **[T04-02]** 詳細表示を進める。
    - **Team B (Search/Map)**: **[T05-01]** フィルタや **[T05-02]** 検索を進める。
    - ※ 一人で進める場合は、**[T04] 詳細表示** を優先することを推奨（「見る→選ぶ→詳細を見る」という基本体験が完成するため）。
6.  **Step 6**: **[T04-03] プレビュー** と **[T06-01] 音声** を実装し、コンテンツをリッチにする。
7.  **Step 7**: 最後に **[T06-02] アニメーション** で質感を高める。

---

## 4. ボトルネックの予見

### 最重要タスク / リスク: [T01-01] データスキーマと初期データセットの定義

- **理由**:
  - 「関係性（Edge）」をどうデータとして表現するか（自動計算するのか、静的に定義するのか）によって、後の実装難易度が劇的に変わる。
  - ここが曖昧だと、[T02-02]以降の描画ロジックや[T05]の検索ロジックで手戻りが発生する。
  - **対策**: 早い段階で「Pitch, Scale, Chord, Key」の全パターンを網羅した小さなプロトタイプデータを作成し、検証すること。

### 技術的リスク: [T02-02] ノードとドメインの静的描画 & [T03-01] ズーム/パン

- **理由**:
  - ノード数が増えた際（数百〜数千）、描画パフォーマンスが低下し、操作感が損なわれる可能性がある。
  - モバイル端末でのパフォーマンス維持が特に課題になりやすい。
  - **対策**: 最初から大量のデータを表示せず、LOD（詳細度制御）の仕組みを意識して設計すること。
