# 音楽理論学習Webアプリケーション 基本設計書

## 1. 五度圏表示画面設計

### 1.1 画面概要

- 画面ID: C001
- 画面名: 五度圏表示画面
- 優先度: 高
- 実装要件ID: F001

### 1.2 画面レイアウト

```
+------------------------------------------+
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |          五度圏表示エリア          |  |
|  |                                    |  |
|  |                                    |  |
|  |                                    |  |
|  |                                    |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |          選択キー情報エリア        |  |
|  +------------------------------------+  |
|                                          |
+------------------------------------------+
```

### 1.3 五度圏の視覚設計

#### 1.3.1 基本構造

- 円形の五度圏を画面中央に配置
- 直径: 画面幅の70%（最大800px）
- 背景: グラデーションを使用（#1a1a1a → #2a2a2a）
- 円の境界線: 1px solid rgba(255, 255, 255, 0.1)

#### 1.3.2 キー表示

- 各キーは円周上に均等に配置
- キー表示の基本スタイル:
  - フォント: Inter, sans-serif
  - サイズ: 1.2rem
  - 色: #ffffff
  - 背景: rgba(255, 255, 255, 0.05)
  - パディング: 1rem
  - 角丸: 8px
  - 影: 0 2px 4px rgba(0, 0, 0, 0.2)

#### 1.3.3 インタラクション

1. ホバー効果

   - スケール: 1.1
   - 背景色: rgba(255, 255, 255, 0.1)
   - トランジション: all 0.3s ease
   - 影: 0 4px 8px rgba(0, 0, 0, 0.3)

2. アクティブ状態

   - スケール: 1.15
   - 背景色: rgba(255, 255, 255, 0.15)
   - 境界線: 2px solid #ffffff
   - 影: 0 6px 12px rgba(0, 0, 0, 0.4)

3. アニメーション
   - 初期表示: フェードイン + スケールアップ
   - ホバー時: スムーズなスケール変更
   - クリック時: 軽いバウンス効果

### 1.4 技術実装詳細

#### 1.4.1 使用ライブラリ

- Framer Motion: アニメーション制御
- Tone.js: 音声再生
- Tailwind CSS: スタイリング

#### 1.4.2 コンポーネント構成

```
components/
  └── CircleOfFifths/
      ├── CircleOfFifths.tsx        # メインコンポーネント
      ├── KeyButton.tsx            # 個別のキーボタン
      ├── KeyInfo.tsx              # 選択キー情報表示
      └── styles/
          └── circleOfFifths.css   # カスタムスタイル
```

#### 1.4.3 状態管理

```typescript
interface CircleOfFifthsState {
  selectedKey: string | null;
  hoveredKey: string | null;
  isPlaying: boolean;
}

// Zustand store
interface CircleOfFifthsStore {
  state: CircleOfFifthsState;
  setSelectedKey: (key: string | null) => void;
  setHoveredKey: (key: string | null) => void;
  setIsPlaying: (isPlaying: boolean) => void;
}
```

### 1.5 インタラクション詳細

#### 1.5.1 マウスオーバー時

1. 視覚的フィードバック

   - キーの強調表示
   - スムーズなスケールアップ
   - 背景色の変更
   - 影の強調

2. 音声フィードバック
   - 該当キーのコードを再生
   - 音量: -12dB
   - 再生遅延: 100ms以内
   - フェードイン/アウト: 0.1秒

#### 1.5.2 クリック時

1. 視覚的フィードバック

   - キーの選択状態を維持
   - より強い強調表示
   - バウンスアニメーション

2. 情報表示
   - 選択キーの詳細情報を表示
   - 関連するコード情報の表示
   - スムーズな情報パネルの表示

### 1.6 パフォーマンス最適化

- コンポーネントのメモ化
- アニメーションのGPUアクセラレーション
- 音声のプリロード
- レンダリングの最適化

### 1.7 アクセシビリティ

- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切なコントラスト比
- フォーカス状態の視覚的表示

### 1.8 エラーハンドリング

- 音声再生失敗時のフォールバック
- アニメーション実行失敗時の代替表示
- エラー状態のユーザーフィードバック

### 1.9 今後の拡張性

- カラーテーマのカスタマイズ
- アニメーション効果のカスタマイズ
- 音声設定のカスタマイズ
- 表示モードの追加（例：相対調表示）

## 2. 五度圏表示画面 実装タスク分解

### 2.1 フェーズ1: 基本構造の実装（T001）

1. **プロジェクトセットアップ（T001-1）**

   - [ ] 必要なディレクトリ構造の作成
   - [ ] コンポーネントファイルの作成
   - [ ] 型定義ファイルの作成

2. **基本コンポーネント実装（T001-2）**

   - [ ] `CircleOfFifths.tsx`の基本構造実装
   - [ ] `KeyButton.tsx`の基本構造実装
   - [ ] `KeyInfo.tsx`の基本構造実装
   - [ ] スタイルファイルの作成

3. **状態管理の実装（T001-3）**
   - [ ] Zustandストアの実装
   - [ ] 状態管理の型定義
   - [ ] 基本的な状態更新関数の実装

### 2.2 フェーズ2: 視覚的実装（T002）

1. **五度圏の基本レイアウト（T002-1）**

   - [ ] 円形レイアウトの実装
   - [ ] キーの配置計算ロジック
   - [ ] 基本的なスタイリング

2. **キーボタンのスタイリング（T002-2）**

   - [ ] キーボタンの基本スタイル
   - [ ] ホバー効果の実装
   - [ ] アクティブ状態のスタイル

3. **アニメーション実装（T002-3）**
   - [ ] Framer Motionのセットアップ
   - [ ] 初期表示アニメーション
   - [ ] ホバーアニメーション
   - [ ] クリックアニメーション

### 2.3 フェーズ3: インタラクション実装（T003）

1. **マウスイベント処理（T003-1）**

   - [ ] ホバーイベントの実装
   - [ ] クリックイベントの実装
   - [ ] 状態更新の連携

2. **音声再生機能（T003-2）**

   - [ ] Tone.jsのセットアップ
   - [ ] コード音声の生成ロジック
   - [ ] 音声再生制御の実装
   - [ ] 音量・フェード制御

3. **情報表示機能（T003-3）**
   - [ ] キー情報の表示実装
   - [ ] アニメーション付きの表示切り替え
   - [ ] 情報パネルのスタイリング

### 2.4 フェーズ4: 最適化と改善（T004）

1. **パフォーマンス最適化（T004-1）**

   - [ ] コンポーネントのメモ化
   - [ ] レンダリング最適化
   - [ ] 音声のプリロード実装

2. **アクセシビリティ対応（T004-2）**

   - [ ] キーボードナビゲーション
   - [ ] スクリーンリーダー対応
   - [ ] フォーカス管理

3. **エラーハンドリング（T004-3）**
   - [ ] エラー状態の定義
   - [ ] フォールバック処理の実装
   - [ ] エラーメッセージの表示

### 2.5 フェーズ5: テストとリファクタリング（T005）

1. **テスト実装（T005-1）**

   - [ ] ユニットテストの作成
   - [ ] インタラクションテスト
   - [ ] エッジケースのテスト

2. **コードレビューとリファクタリング（T005-2）**

   - [ ] コード品質の確認
   - [ ] パフォーマンスの測定
   - [ ] 不要なコードの削除

3. **ドキュメント整備（T005-3）**
   - [ ] コンポーネントのドキュメント作成
   - [ ] 使用方法の説明
   - [ ] メンテナンス手順の記載

### 2.6 実装の優先順位と依存関係

1. 必須実装（Phase 1-3）

   - 基本構造
   - 視覚的実装
   - インタラクション

2. 推奨実装（Phase 4）

   - パフォーマンス最適化
   - アクセシビリティ

3. オプション実装（Phase 5）
   - テスト
   - ドキュメント

### 2.7 各タスクの見積もり

- T001: 2時間
- T002: 3時間
- T003: 4時間
- T004: 2時間
- T005: 2時間
  合計: 約13時間

### 2.8 実装の進め方

1. 各フェーズは順次実装
2. 各タスクは独立して実装可能
3. タスク完了ごとに動作確認
4. 必要に応じて設計の見直し
