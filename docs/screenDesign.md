# 音楽理論学習Webアプリケーション 基本設計書

## 1. 五度圏表示画面設計

### 1.1 画面概要

- 画面ID: C001
- 画面名: 五度圏表示画面
- 優先度: 高
- 実装要件ID: F001

### 1.2 画面レイアウト

```
+------------------------------------------+
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |          五度圏表示エリア          |  |
|  |                                    |  |
|  |                                    |  |
|  |                                    |  |
|  |                                    |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |          選択キー情報エリア        |  |
|  +------------------------------------+  |
|                                          |
+------------------------------------------+
```

### 1.3 五度圏の視覚設計

#### 1.3.1 基本構造

- 円形の五度圏を画面中央に配置
- 直径: 画面幅の80%（最大800px）
- 背景: グラデーションを使用（#1a1a1a → #2a2a2a）
- 円の境界線: 1px solid rgba(255, 255, 255, 0.1)

#### 1.3.2 キー表示

- 各キーは円周上に均等に配置
- 3層構造：内側（マイナーキー）、中間（メジャーキー）、外側（調号）
- キー表示の基本スタイル:
  - フォント: Inter, sans-serif
  - マイナーキー: 0.8rem, フォントウェイト50
  - メジャーキー: 1rem, フォントウェイト80
  - 色: #ffffff
  - 背景: rgba(255, 255, 255, 0.05-0.15)
  - 角丸: 8px
  - 影: 0 2px 4px rgba(0, 0, 0, 0.2)

#### 1.3.3 インタラクション

1. ホバー効果

   - スケール: 1.02
   - 背景色: rgba(255, 255, 255, 0.25)
   - トランジション: all 0.3s ease
   - 影: 0 4px 8px rgba(0, 0, 0, 0.3)

2. アクティブ状態

   - スケール: 0.98
   - 背景色: rgba(255, 255, 255, 0.3)
   - 境界線: 2px solid #ffffff
   - 影: 0 6px 12px rgba(0, 0, 0, 0.4)

3. アニメーション
   - 初期表示: フェードイン + スケールアップ
   - ホバー時: スムーズなスケール変更
   - クリック時: 軽いバウンス効果

### 1.4 技術実装詳細

#### 1.4.1 使用ライブラリ

- Framer Motion: アニメーション制御
- Tone.js: 音声再生
- Tailwind CSS: スタイリング
- Zustand: 状態管理
- clsx: クラス名管理
- tailwind-merge: クラス名マージ

#### 1.4.2 コンポーネント構成

```
src/
  ├── components/
  │   └── CircleOfFifths/
  │       ├── CircleOfFifths.tsx        # メインコンポーネント
  │       ├── components/
  │       │   ├── CircleSegment.tsx     # セグメント描画
  │       │   ├── KeyArea.tsx           # 個別のキーエリア
  │       │   └── KeyInfoDisplay.tsx    # 選択キー情報表示
  │       ├── hooks/                    # カスタムフック
  │       │   ├── useCircleOfFifths.ts  # CircleOfFifths用フック
  │       │   └── useKeyArea.ts         # KeyArea用フック
  │       ├── types/
  │       │   └── props.ts              # コンポーネント型定義
  │       ├── constants/
  │       │   └── index.ts              # 定数定義
  │       ├── utils/
  │       │   └── index.ts              # ユーティリティ関数
  │       ├── animations.ts             # アニメーション定義
  │       └── README.md                 # コンポーネント説明
  ├── store/
  │   └── circleOfFifthsStore.ts        # Zustandストア
  └── types/
      └── circleOfFifths.ts             # グローバル型定義
```

#### 1.4.3 状態管理

```typescript
interface CircleOfFifthsState {
  selectedKey: Key | null;
  hoveredKey: Key | null;
  isPlaying: boolean;
}

// Zustand store
interface CircleOfFifthsStore {
  state: CircleOfFifthsState;
  setSelectedKey: (key: Key | null) => void;
  setHoveredKey: (key: Key | null) => void;
  setIsPlaying: (isPlaying: boolean) => void;
}
```

### 1.5 インタラクション詳細

#### 1.5.1 マウスオーバー時

1. 視覚的フィードバック

   - キーの強調表示
   - スムーズなスケールアップ
   - 背景色の変更
   - 影の強調

2. 音声フィードバック
   - 該当キーのコードを再生
   - 音量: -12dB
   - 再生遅延: 100ms以内
   - フェードイン/アウト: 0.1秒

#### 1.5.2 クリック時

1. 視覚的フィードバック

   - キーの選択状態を維持
   - より強い強調表示
   - バウンスアニメーション

2. 情報表示
   - 選択キーの詳細情報を表示
   - 関連するコード情報の表示
   - スムーズな情報パネルの表示

### 1.6 パフォーマンス最適化

- コンポーネントのメモ化
- アニメーションのGPUアクセラレーション
- 音声のプリロード
- レンダリングの最適化

### 1.7 アクセシビリティ

- キーボードナビゲーション対応
- スクリーンリーダー対応（aria-label、role属性）
- 適切なコントラスト比
- フォーカス状態の視覚的表示

### 1.8 エラーハンドリング

- 音声再生失敗時のフォールバック
- アニメーション実行失敗時の代替表示
- エラー状態のユーザーフィードバック
- 型安全性の確保

### 1.9 今後の拡張性

- カラーテーマのカスタマイズ
- アニメーション効果のカスタマイズ
- 音声設定のカスタマイズ
- 表示モードの追加（例：相対調表示）
