# LayerController Feature

> **ä½œæˆæ—¥**: 2025-01-18
> **æ›´æ–°æ—¥**: 2025-01-18
> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
> **ä½œæˆè€…**: AI Assistant

éŸ³æ¥½ç†è«–ã®å„è¦ç´ ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã€ã‚³ãƒ¼ãƒ‰ã€é–¢ä¿‚æ€§ï¼‰ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ¶å¾¡ã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼æ©Ÿèƒ½ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ãªæƒ…å ±ã®ã¿ã‚’é¸æŠçš„ã«è¡¨ç¤ºã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã™ã‚‹ã€‚

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [æŠ€è¡“ä»•æ§˜](#æŠ€è¡“ä»•æ§˜)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æ©Ÿèƒ½è©³ç´°](#æ©Ÿèƒ½è©³ç´°)
- [è¨­è¨ˆæ€æƒ³](#è¨­è¨ˆæ€æƒ³)
- [é–‹ç™ºãƒ»ä¿å®ˆ](#é–‹ç™ºä¿å®ˆ)

## æ¦‚è¦

### ç›®çš„ãƒ»å½¹å‰²

LayerControlleræ©Ÿèƒ½ã¯ã€éŸ³æ¥½ç†è«–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹æƒ…å ±ã®éšå±¤çš„è¡¨ç¤ºåˆ¶å¾¡ã‚’æ‹…ã†ã€‚è¤‡é›‘ãªéŸ³æ¥½ç†è«–æ¦‚å¿µã‚’æ®µéšçš„ã«å­¦ç¿’ã§ãã‚‹ã‚ˆã†ã€å¿…è¦ãªæƒ…å ±ã®ã¿ã‚’é¸æŠçš„ã«è¡¨ç¤ºãƒ»éè¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½

- **ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†**: éŸ³æ¥½ç†è«–ã®å„è¦ç´ ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’åˆ¶å¾¡
- **ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰åˆ¶å¾¡**: ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
- **ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³UI**: æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®šãƒ‘ãƒãƒ«

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

- **LayerController**: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã®çµ±æ‹¬ï¼‰
- **ChordLayerAccordion**: ã‚³ãƒ¼ãƒ‰é–¢é€£ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆ¶å¾¡UIï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å½¢å¼ï¼‰

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆå›³

```mermaid
graph TD
    A[LayerController] --> B[ChordLayerAccordion]
    B --> C[Accordion]
    C --> D[AccordionItem]
    D --> E[AccordionTrigger]
    D --> F[AccordionContent]
    F --> G[Label]
    F --> H[Switch]
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³

```mermaid
flowchart LR
    A[è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ] -->|className| B[LayerController]
    B --> C[ChordLayerAccordion]
    C -->|state| D[useLayerStore]
    D -->|isDiatonicChordsVisible| E[Switch]
    E -->|onCheckedChange| F[toggleDiatonicChords]
    F -->|update| D
    D -->|state| G[useDiatonicChordHighlight]
    G -->|highlight info| H[Circle of Fifths]
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
src/features/layer-controller/
â”œâ”€â”€ README.md                           # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ index.ts                           # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ components/                        # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”œâ”€â”€ LayerController.tsx            # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
    â””â”€â”€ ChordLayerAccordion.tsx        # ã‚³ãƒ¼ãƒ‰ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¶å¾¡
```

### ä¾å­˜é–¢ä¿‚

#### å†…éƒ¨ä¾å­˜

- `@/components/ui/accordion` - ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³UI
- `@/components/ui/label` - ãƒ©ãƒ™ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `@/components/ui/switch` - ã‚¹ã‚¤ãƒƒãƒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `@/stores/layerStore` - ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ç®¡ç†
- `@/types/common` - å…±é€šå‹å®šç¾©

#### å¤–éƒ¨ä¾å­˜

- `react` - Reactãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- `zustand` - çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- `clsx` - ã‚¯ãƒ©ã‚¹åçµåˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

## æŠ€è¡“ä»•æ§˜

### Propsä»•æ§˜

#### LayerController

```typescript
import { ClassNameProps } from '@/types/common';

interface LayerControllerProps extends ClassNameProps {
  /** ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¹å */
  className?: string;
}
```

#### ChordLayerAccordion

```typescript
interface ChordLayerAccordionProps {
  // Propsãªã—ï¼ˆå†…éƒ¨çŠ¶æ…‹ã®ã¿ä½¿ç”¨ï¼‰
}
```

### çŠ¶æ…‹ç®¡ç†

#### ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ (Zustand)

```typescript
interface LayerState {
  /** ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºçŠ¶æ…‹ */
  isDiatonicChordsVisible: boolean;
}

interface LayerActions {
  /** ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ */
  toggleDiatonicChords: () => void;
}
```

### APIä»•æ§˜

#### å…¬é–‹ãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰å             | å¼•æ•° | æˆ»ã‚Šå€¤ | èª¬æ˜                                     |
| ---------------------- | ---- | ------ | ---------------------------------------- |
| `toggleDiatonicChords` | ãªã— | void   | ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ |

#### ã‚¤ãƒ™ãƒ³ãƒˆ

| ã‚¤ãƒ™ãƒ³ãƒˆå        | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰         | èª¬æ˜                       |
| ----------------- | ------------------ | -------------------------- |
| `onCheckedChange` | `checked: boolean` | ã‚¹ã‚¤ãƒƒãƒã®çŠ¶æ…‹å¤‰æ›´æ™‚ã«ç™ºç« |

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ç”¨

```tsx
import { LayerController } from '@/features/layer-controller';

function App() {
  return (
    <div>
      <LayerController className="w-full" />
    </div>
  );
}
```

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹

```tsx
import { LayerController } from '@/features/layer-controller';

function CustomLayout() {
  return (
    <div className="sidebar">
      <LayerController className="border-r p-4" />
    </div>
  );
}
```

### å€‹åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨

```tsx
import { ChordLayerAccordion } from '@/features/layer-controller';

function ChordSettings() {
  return (
    <div className="settings-panel">
      <ChordLayerAccordion />
    </div>
  );
}
```

## æ©Ÿèƒ½è©³ç´°

### ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºæ©Ÿèƒ½

#### ãƒˆã‚°ãƒ«OFFæ™‚ï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰

- äº”åº¦åœä¸Šã®ã‚­ãƒ¼ã‚¨ãƒªã‚¢ã¯é€šå¸¸è¡¨ç¤º
- ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰æƒ…å ±ã¯è¡¨ç¤ºã•ã‚Œãªã„
- `useDiatonicChordHighlight`ãƒ•ãƒƒã‚¯ãŒç©ºã®Mapã‚’è¿”ã™

#### ãƒˆã‚°ãƒ«ONæ™‚

- **ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º**: ç¾åœ¨ã®ã‚­ãƒ¼ã®ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ãŒäº”åº¦åœä¸Šã§ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã•ã‚Œã‚‹
- **ãƒ­ãƒ¼ãƒæ•°å­—è¡¨ç¤º**: å„ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã«ãƒ­ãƒ¼ãƒæ•°å­—ï¼ˆI, ii, iii, IV, V, vi, viiÂ°ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- **è¦–è¦šçš„å¼·èª¿**: ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ã«è©²å½“ã™ã‚‹ã‚­ãƒ¼ã‚¨ãƒªã‚¢ãŒè¦–è¦šçš„ã«åŒºåˆ¥ã•ã‚Œã‚‹

#### å®Ÿè£…è©³ç´°

```typescript
// ãƒˆã‚°ãƒ«ONã®å ´åˆã®å‹•ä½œä¾‹
const diatonicChordInfo = currentKey.getDiatonicChordsInfo();
// => [
//   { chord: C-major, romanDegreeName: "I" },
//   { chord: D-minor, romanDegreeName: "ii" },
//   { chord: E-minor, romanDegreeName: "iii" },
//   // ... ä»–ã®ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰
// ]
```

#### å½±éŸ¿ç¯„å›²

- **Circle of Fifths**: `src/features/circle-of-fifths/hooks/useDiatonicChordHighlight.ts`
  - `isDiatonicChordsVisible`ã®çŠ¶æ…‹ã«åŸºã¥ã„ã¦ãƒã‚¤ãƒ©ã‚¤ãƒˆæƒ…å ±ã‚’è¨ˆç®—
  - å„KeyAreaã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒã‚¤ãƒ©ã‚¤ãƒˆæƒ…å ±ã¨ãƒ­ãƒ¼ãƒæ•°å­—ã‚’æä¾›
- **KeyArea Component**: `src/features/circle-of-fifths/components/KeyArea.tsx`
  - ãƒã‚¤ãƒ©ã‚¤ãƒˆçŠ¶æ…‹ã«å¿œã˜ãŸè¦–è¦šçš„è¡¨ç¾ã®å¤‰æ›´
  - ãƒ­ãƒ¼ãƒæ•°å­—ã®è¡¨ç¤ºãƒ»éè¡¨ç¤º

### çŠ¶æ…‹é€£å‹•ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant Switch
    participant LayerStore
    participant Hook
    participant KeyArea

    User->>Switch: ãƒˆã‚°ãƒ«æ“ä½œ
    Switch->>LayerStore: toggleDiatonicChords()
    LayerStore->>LayerStore: isDiatonicChordsVisible = true
    LayerStore->>Hook: çŠ¶æ…‹å¤‰æ›´é€šçŸ¥
    Hook->>Hook: ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰æƒ…å ±è¨ˆç®—
    Hook->>KeyArea: ãƒã‚¤ãƒ©ã‚¤ãƒˆæƒ…å ±æä¾›
    KeyArea->>KeyArea: è¡¨ç¤ºæ›´æ–°ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆ + ãƒ­ãƒ¼ãƒæ•°å­—ï¼‰
```

## è¨­è¨ˆæ€æƒ³

### 1. å˜ä¸€è²¬ä»»åŸå‰‡

LayerControlleræ©Ÿèƒ½ã¯ã€ŒéŸ³æ¥½ç†è«–è¦ç´ ã®è¡¨ç¤ºåˆ¶å¾¡ã€ã¨ã„ã†å˜ä¸€ã®è²¬ä»»ã‚’æŒã¤ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚æ˜ç¢ºã«å½¹å‰²ã‚’åˆ†é›¢ã—ã¦ã„ã‚‹ï¼š

- LayerController: ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã®ã‚³ãƒ³ãƒ†ãƒŠ
- ChordLayerAccordion: ã‚³ãƒ¼ãƒ‰é–¢é€£è¨­å®šã®UI

### 2. å†åˆ©ç”¨æ€§

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç‹¬ç«‹ã—ã¦ä½¿ç”¨å¯èƒ½
- çŠ¶æ…‹ç®¡ç†ã¯Zustandã§é›†ç´„ã—ã€ã©ã“ã‹ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ClassNamePropsã«ã‚ˆã‚ŠæŸ”è»Ÿãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆ

### 3. ä¿å®ˆæ€§

- æ©Ÿèƒ½ã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†é›¢
- å‹å®‰å…¨æ€§ã‚’é‡è¦–ã—ãŸTypeScriptå®Ÿè£…
- æ˜ç¢ºãªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ§‹é€ 

### 4. æ‹¡å¼µæ€§

- æ–°ã—ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ç¨®åˆ¥ã®è¿½åŠ ãŒå®¹æ˜“
- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³æ§‹é€ ã«ã‚ˆã‚Šè¤‡æ•°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç®¡ç†ã«å¯¾å¿œ
- çŠ¶æ…‹ç®¡ç†ã®æ§‹é€ ã¯è¿½åŠ æ©Ÿèƒ½ã«å¯¾ã—ã¦æŸ”è»Ÿ

### 5. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£

- ç›´æ„Ÿçš„ãªã‚¹ã‚¤ãƒƒãƒUIã«ã‚ˆã‚‹æ“ä½œ
- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã«ã‚ˆã‚‹æ®µéšçš„ãªæƒ…å ±é–‹ç¤º
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œ

## é–‹ç™ºãƒ»ä¿å®ˆ

### æ–°ã—ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ æ‰‹é †

1. `src/stores/layerStore.ts`ã«çŠ¶æ…‹ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
2. å¿…è¦ã«å¿œã˜ã¦æ–°ã—ã„Accordionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
3. `LayerController.tsx`ã«æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ 
4. `index.ts`ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
5. é–¢é€£ã™ã‚‹ãƒ•ãƒƒã‚¯ï¼ˆ`useDiatonicChordHighlight`ãªã©ï¼‰ã‚’æ›´æ–°

### ãƒ†ã‚¹ãƒˆå¯¾è±¡

- ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã®åˆ‡ã‚Šæ›¿ãˆå‹•ä½œ
- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¡¨ç¤ºãƒ»éè¡¨ç¤º
- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®å±•é–‹ãƒ»æŠ˜ã‚ŠãŸãŸã¿
- ãƒ€ã‚¤ã‚¢ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆã®è¡¨ç¤ºãƒ»éè¡¨ç¤º
- ãƒ­ãƒ¼ãƒæ•°å­—è¡¨è¨˜ã®è¡¨ç¤ºãƒ»éè¡¨ç¤º

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è¦ä»¶å®šç¾©æ›¸](../../docs/00.project/0001.requirements.md)
- [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ](../../docs/20.development/2003.frontend-design.md)
- [çŠ¶æ…‹ç®¡ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../../docs/20.development/2004.architecture.md)
- [Circle of Fifths Feature](../circle-of-fifths/README.md)

---

> ğŸ“ **Note**: ã“ã®è¨­è¨ˆæ›¸ã¯é–‹ç™ºè¦ç´„ã«å¾“ã£ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
> ğŸ”„ **Update**: æ©Ÿèƒ½è¿½åŠ ãƒ»å¤‰æ›´æ™‚ã¯ã“ã®è¨­è¨ˆæ›¸ã‚‚åˆã‚ã›ã¦æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
> ğŸ¤ **Collaboration**: ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°é–‹ç™ºãƒãƒ¼ãƒ ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
